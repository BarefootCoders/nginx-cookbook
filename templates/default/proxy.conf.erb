<% if @app.upstream_servers.any? -%>
upstream <%= @app.name %> {
  <% @app.upstream_servers.each do |upstream_server| %>
  server <%= upstream_server %>;
  <% end %>
}
<% end -%>

server {
  listen <%= @app.server_port %>;
  server_name <%= @app.server_name %>;

  root <%= @app.public_path %>;

  <% if @app.try_files.any? %>
  try_files <%= @app.try_files.join(" ") %>;
  <% end %>

  <% @app.locations.each do |location| %>
  location <%= location[:path] %> {
    <%= location[:directives].join("\n\s\s\s\s") %>
  }
  <% end %>

  error_page 500 502 503 504 <%= @app.error_page %>;
  client_max_body_size <%= @app.client_max_body_size %>;
  keepalive_timeout <%= @app.keepalive_timeout %>;

  <%= @app.custom_directives.join("\n\s\s") + "\n" -%>
}
